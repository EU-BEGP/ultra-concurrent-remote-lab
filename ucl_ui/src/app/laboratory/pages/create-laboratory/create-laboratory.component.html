<app-navbar></app-navbar>

<div>
    <mat-card class="page-container">
        <mat-card-title class="page-title">
            <span class="first-title header2">Create New</span>
            <span class="second-title header2">Laboratory</span>
        </mat-card-title>

        <mat-card-content>
            <form [formGroup]="newLaboratory" (ngSubmit)="onSubmit()">
                <mat-stepper [linear]="false"
                    [orientation]="(stepperOrientation | async)!">
                    <div formGroupName="info">
                        <mat-step label="Laboratory Info"
                            [stepControl]="info">
                            <span mat-caption class="input-label header3"> Enter
                                the
                                Name
                                of your Institution </span>
                            <mat-form-field class="input-field"
                                appearance="outline">
                                <input matInput placeholder="University of.."
                                    formControlName="institution" required>
                            </mat-form-field>
                            <span mat-caption class="input-label header3"> Enter
                                the
                                Name
                                of your Laboratory </span>
                            <mat-form-field class="input-field"
                                appearance="outline">
                                <input matInput
                                    placeholder="Photovoltaic Laboratory"
                                    formControlName="name" required>
                            </mat-form-field>
                            <span mat-caption class="input-label header3">
                                Choose
                                the Category that best suits your Laboratory
                            </span>
                            <mat-form-field appearance="outline"
                                class="input-field">
                                <mat-select placeholder="Photovoltaic Energy"
                                    formControlName="category"
                                    required>
                                    <mat-option
                                        *ngFor="let category of categories"
                                        [value]="category.name">
                                        {{category.name}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>

                            <mat-card-actions>
                                <button type="button" class="header2"
                                    mat-raised-button
                                    matStepperNext>Next</button>
                            </mat-card-actions>
                        </mat-step>
                    </div>
                    <div formGroupName="introduction">
                        <mat-step label="Introduction"
                            [stepControl]="introduction">
                            <span mat-caption class="input-label header3"> Enter
                                a
                                Introduction for your Laboratory
                            </span>
                            <mat-form-field appearance="outline"
                                class="input-field">
                                <input matInput
                                    placeholder="This Laboratory wil cover..."
                                    formControlName="description" required>
                            </mat-form-field>

                            <span mat-caption
                                class="upload-title input-label header3 mb-16">
                                Upload
                                a Introduction / Description Video for your
                                Laboratory</span>

                            <mat-card
                                class="intro-video-card mat-elevation-z4 center mb-16"
                                formGroupName="introVideo">
                                <vg-player
                                    class="video-container mb-16">

                                    <vg-overlay-play></vg-overlay-play>
                                    <vg-buffering></vg-buffering>

                                    <vg-scrub-bar>
                                        <vg-scrub-bar-current-time></vg-scrub-bar-current-time>
                                        <vg-scrub-bar-buffering-time></vg-scrub-bar-buffering-time>
                                    </vg-scrub-bar>

                                    <vg-controls [vgAutohide]="true"
                                        [vgAutohideTime]="3">
                                        <vg-play-pause></vg-play-pause>
                                        <vg-playback-button
                                            [playbackValues]="[ '0.5', '1.0', '2.0', '5.0' ]"></vg-playback-button>

                                        <vg-time-display vgProperty="current"
                                            vgFormat="mm:ss"></vg-time-display>

                                        <vg-scrub-bar
                                            style="pointer-events: none;"></vg-scrub-bar>

                                        <vg-time-display vgProperty="left"
                                            vgFormat="mm:ss"></vg-time-display>
                                        <vg-time-display vgProperty="total"
                                            vgFormat="mm:ss"></vg-time-display>

                                        <vg-mute></vg-mute>
                                        <vg-volume></vg-volume>

                                        <vg-fullscreen></vg-fullscreen>
                                    </vg-controls>

                                    <video [vgMedia]="$any(media)"
                                        #media class="video-player"
                                        preload="auto"
                                        [src]="introVideo.value.video"></video>
                                </vg-player>
                                <mat-card-content>
                                    <mat-card-actions
                                        class="video-actions">
                                        <div style="height: 36px;">
                                            <button type="button"
                                                #file
                                                id="button"
                                                mat-button>
                                                <mat-icon
                                                    class="bigger-icon accent">upload</mat-icon>
                                            </button>
                                            <div
                                                style="display: inline-block"
                                                matTooltip="Upload Video">
                                                <input id="myInput"
                                                    name="video"
                                                    type="file"
                                                    accept="video/*"
                                                    (change)="onUploadIntro($event)" />
                                                <p
                                                    id="label">{{file}}</p>
                                            </div>
                                        </div>
                                    </mat-card-actions>
                                </mat-card-content>
                            </mat-card>

                            <span mat-caption
                                class="input-label header3 mt-8">
                                Add
                                Guides
                                for your Laboratory</span>
                            <div formArrayName="guides"
                                class="center">
                                <div
                                    *ngFor="let guide of guides.controls; index as guideIndex"
                                    [formGroupName]="guideIndex">
                                    <div style="display: flex">
                                        <span mat-caption
                                            class="accent input-label header3">
                                            Guide
                                            {{guideIndex+1}}
                                        </span>
                                        <button type="button"
                                            mat-button
                                            (click)="deleteGuide(guideIndex)">
                                            <mat-icon
                                                class="bigger-icon accent"
                                                matTooltip="Delete Guide">delete</mat-icon>
                                        </button>
                                    </div>
                                    <span mat-caption
                                        class="input-label header3">
                                        Title
                                    </span>
                                    <mat-form-field
                                        class="input-field"
                                        appearance="outline">
                                        <input matInput
                                            placeholder="Lesson 1"
                                            formControlName="title"
                                            required>
                                    </mat-form-field>
                                    <span mat-caption
                                        class="input-label header3">
                                        Link / URL
                                    </span>
                                    <mat-form-field
                                        class="input-field"
                                        appearance="outline">
                                        <input matInput
                                            placeholder="http://file"
                                            formControlName="link"
                                            required>
                                    </mat-form-field>
                                </div>
                                <button type="button" mat-button
                                    class="center"
                                    (click)="addGuide()">
                                    <mat-icon class="add-new"
                                        matTooltip="New Guide">add_circle_outline</mat-icon>
                                </button>
                            </div>

                            <mat-card-actions>
                                <button type="button" mat-raised-button
                                    matStepperPrevious
                                    class="secondary-button header2">Back</button>
                                <button type="button" class="header2"
                                    mat-raised-button
                                    matStepperNext>Next</button>
                            </mat-card-actions>
                        </mat-step>
                    </div>
                    <div formArrayName="parameters">
                        <mat-step label="Parameters"
                            [stepControl]="parameters">
                            <div
                                *ngFor="let parameter of parameters.controls; index as i"
                                [formGroupName]="i">
                                <div style="display: flex">
                                    <span mat-caption
                                        class="accent input-label header3">
                                        Parameter
                                        {{i+1}}
                                    </span>
                                    <button mat-button type="button"
                                        (click)="deleteParameter(i)">
                                        <mat-icon
                                            class="bigger-icon accent"
                                            matTooltip="Delete Parameter">delete</mat-icon>
                                    </button>
                                </div>

                                <span mat-caption
                                    class="input-label header3"> Enter the
                                    Name / Type of the Parameter </span>
                                <mat-form-field class="input-field"
                                    appearance="outline">
                                    <input matInput placeholder="Ball Material"
                                        formControlName="name" required>
                                </mat-form-field>
                                <span mat-caption class="input-label header3">
                                    Add
                                    Options for this Parameter </span>
                                <mat-grid-list [cols]="breakpoint"
                                    [gutterSize]="'16px'"
                                    rowHeight="312px"
                                    (window:resize)="onResize($event)"
                                    formArrayName="options">
                                    <mat-grid-tile
                                        *ngFor="let option of getOptions(i).controls; index as optionIndex">
                                        <mat-card
                                            class="parameter-option mat-elevation-z4"
                                            [formGroupName]="optionIndex">

                                            <img mat-card-image
                                                [src]="option.value.photo">
                                            <mat-card-content>
                                                <mat-label class="body">Name /
                                                    Value</mat-label>
                                                <mat-form-field
                                                    class="input-field"
                                                    appearance="outline">
                                                    <input matInput
                                                        placeholder="Metal Ball"
                                                        formControlName="value"
                                                        required
                                                        class="option-input">
                                                </mat-form-field>
                                                <mat-card-actions>
                                                    <div style="height: 36px;">
                                                        <button #file
                                                            type="button"
                                                            id="button"
                                                            mat-button>
                                                            <mat-icon
                                                                class="accent">upload</mat-icon>
                                                        </button>
                                                        <div
                                                            style="display: inline-block"
                                                            matTooltip="Upload Image">
                                                            <input id="myInput"
                                                                name="file"
                                                                type="file"
                                                                accept="image/*"
                                                                (change)="onUploadFile($event, i,optionIndex, 'image')" />
                                                            <p
                                                                id="label">{{file}}</p>

                                                        </div>
                                                    </div>

                                                    <button mat-button
                                                        type="button"
                                                        (click)="deleteOption(i, optionIndex)">
                                                        <mat-icon
                                                            class="accent"
                                                            matTooltip="Delete Option">delete</mat-icon>
                                                    </button>
                                                </mat-card-actions>
                                            </mat-card-content>
                                        </mat-card>
                                    </mat-grid-tile>
                                    <mat-grid-tile>
                                        <button mat-button
                                            type="button"
                                            (click)="addOption(i)">
                                            <mat-icon class="add-new"
                                                matTooltip="New Option">library_add</mat-icon>
                                        </button>
                                    </mat-grid-tile>
                                </mat-grid-list>
                                <mat-divider></mat-divider>
                            </div>

                            <div class="center">
                                <span mat-caption
                                    class="header3">
                                    Add new
                                    Parameter </span>
                                <br>
                                <button type="button" mat-button
                                    (click)="addParameter()">
                                    <mat-icon class="add-new"
                                        matTooltip="New Parameter">add_circle_outline</mat-icon>
                                </button>
                            </div>
                            <mat-card-actions>
                                <button type="button" mat-raised-button
                                    matStepperPrevious
                                    class="secondary-button header2">Back</button>
                                <button type="button" class="header2"
                                    mat-raised-button
                                    matStepperNext>Next</button>
                            </mat-card-actions>
                        </mat-step>
                    </div>

                    <div formGroupName="experiments">
                        <mat-step label="Experiments"
                            [stepControl]="experiments">

                            <div
                                *ngFor="let experiment of experiments.controls; index as i"
                                [formGroupName]="i">
                                <div style="display: flex">
                                    <span mat-caption
                                        class="accent input-label header3">
                                        Experiment
                                        {{i+1}}
                                    </span>
                                    <button type="button" mat-button
                                        (click)="deleteExperiment(i)">
                                        <mat-icon
                                            class="bigger-icon accent"
                                            matTooltip="Delete Experiment">delete</mat-icon>
                                    </button>
                                </div>
                                <span mat-caption
                                    class="input-label header3"> Choose the
                                    Parameters of Experiment {{i+1}}
                                </span>
                                <mat-grid-list [cols]="breakpointOption"
                                    [gutterSize]="'16px'"
                                    rowHeight="80px"
                                    (window:resize)="onResizeParameter($event)"
                                    formArrayName="selectedOptions">
                                    <mat-grid-tile
                                        *ngFor="let parameter of parameters.controls; index as j"
                                        style="display: flex">
                                        <span mat-caption
                                            class="parameter-title input-label header3">
                                            {{parameter.value.name}}
                                        </span>
                                        <mat-form-field
                                            appearance="outline"
                                            class="ml-8 input-field">
                                            <mat-select
                                                placeholder="Choose Option"
                                                required
                                                [formControlName]="j">
                                                <mat-option
                                                    *ngFor="let option of getAvailableOptions(j)"
                                                    [value]="option.value.id">
                                                    {{option.value.value}}
                                                </mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                    </mat-grid-tile>

                                </mat-grid-list>

                                <div class="row">
                                    <div class="column">

                                        <span mat-caption
                                            class="input-label header3 vertical-center">
                                            Add
                                            Video(s)
                                            for Experiment {{i+1}}
                                            <button type="button" mat-button
                                                (click)="addVideo(i)">
                                                <mat-icon class="add-new"
                                                    matTooltip="New Video">library_add</mat-icon>
                                            </button></span>
                                        <mat-grid-list
                                            [cols]="breakpointVideo"
                                            [gutterSize]="'16px'"
                                            [rowHeight]="videoRowHeight"
                                            (window:resize)="onResizeParameter($event)"
                                            formArrayName="videos"
                                            class="grid-left">
                                            <mat-grid-tile
                                                *ngFor="let video of getVideos(i).controls; index as videoIndex">
                                                <mat-card
                                                    class="video-card mat-elevation-z4"
                                                    [formGroupName]="videoIndex">

                                                    <vg-player
                                                        class="video-container mb-16">

                                                        <vg-overlay-play></vg-overlay-play>
                                                        <vg-buffering></vg-buffering>

                                                        <vg-scrub-bar>
                                                            <vg-scrub-bar-current-time></vg-scrub-bar-current-time>
                                                            <vg-scrub-bar-buffering-time></vg-scrub-bar-buffering-time>
                                                        </vg-scrub-bar>

                                                        <vg-controls
                                                            [vgAutohide]="true"
                                                            [vgAutohideTime]="3">
                                                            <vg-play-pause></vg-play-pause>
                                                            <vg-playback-button
                                                                [playbackValues]="[ '0.5', '1.0', '2.0', '5.0' ]"></vg-playback-button>

                                                            <vg-time-display
                                                                vgProperty="current"
                                                                vgFormat="mm:ss"></vg-time-display>

                                                            <vg-scrub-bar
                                                                style="pointer-events: none;"></vg-scrub-bar>

                                                            <vg-time-display
                                                                vgProperty="left"
                                                                vgFormat="mm:ss"></vg-time-display>
                                                            <vg-time-display
                                                                vgProperty="total"
                                                                vgFormat="mm:ss"></vg-time-display>

                                                            <vg-mute></vg-mute>
                                                            <vg-volume></vg-volume>

                                                            <vg-fullscreen></vg-fullscreen>
                                                        </vg-controls>

                                                        <video
                                                            [vgMedia]="$any(media)"
                                                            #media
                                                            class="video-player"
                                                            preload="auto"
                                                            [src]="video.value.video"></video>
                                                    </vg-player>
                                                    <mat-card-content>
                                                        <mat-label
                                                            class="body">Video
                                                            Name</mat-label>
                                                        <mat-form-field
                                                            class="input-field"
                                                            appearance="outline">
                                                            <input matInput
                                                                placeholder="Front View"
                                                                formControlName="name"
                                                                required
                                                                class="option-input">
                                                        </mat-form-field>
                                                        <mat-card-actions
                                                            class="video-actions">
                                                            <div
                                                                style="height: 36px;">
                                                                <button
                                                                    type="button"
                                                                    #file
                                                                    id="button"
                                                                    mat-button>
                                                                    <mat-icon
                                                                        class="accent bigger-icon">upload</mat-icon>
                                                                </button>
                                                                <div
                                                                    style="display: inline-block"
                                                                    matTooltip="Upload Video">
                                                                    <input
                                                                        id="myInput"
                                                                        name="video"
                                                                        type="file"
                                                                        accept="video/*"
                                                                        (change)="onUploadFile($event, i,videoIndex, 'video')" />
                                                                    <p
                                                                        id="label">{{file}}</p>

                                                                </div>
                                                            </div>
                                                            <button
                                                                type="button"
                                                                mat-button
                                                                (click)="deleteVideo(i, videoIndex)">
                                                                <mat-icon
                                                                    class="accent  bigger-icon"
                                                                    matTooltip="Delete Video">delete</mat-icon>
                                                            </button>
                                                        </mat-card-actions>
                                                    </mat-card-content>
                                                </mat-card>
                                            </mat-grid-tile>

                                        </mat-grid-list>
                                    </div>
                                    <div class="column">
                                        <span mat-caption
                                            class="input-label header3 mt-8">
                                            Add
                                            Activities
                                            for Experiment {{i+1}} </span>
                                        <div formArrayName="activities"
                                            class="center">
                                            <div
                                                *ngFor="let activity of getExperimentActivites(i).controls; index as activityIndex"
                                                [formGroupName]="activityIndex">
                                                <div style="display: flex">
                                                    <span mat-caption
                                                        class="accent input-label header3">
                                                        Activity
                                                        {{activityIndex+1}}
                                                    </span>
                                                    <button type="button"
                                                        mat-button
                                                        (click)="deleteExperimentActivity(i,activityIndex)">
                                                        <mat-icon
                                                            class="bigger-icon accent"
                                                            matTooltip="Delete Activity">delete</mat-icon>
                                                    </button>
                                                </div>
                                                <span mat-caption
                                                    class="input-label header3">
                                                    Exercise Statement
                                                </span>

                                                <mat-form-field
                                                    class="input-field"
                                                    appearance="outline">
                                                    <input matInput
                                                        placeholder="Question {{activityIndex+1}}"
                                                        formControlName="statement"
                                                        required>
                                                </mat-form-field>
                                                <span mat-caption
                                                    class="input-label header3">
                                                    Expected Result
                                                    (Optional)
                                                </span>
                                                <mat-form-field
                                                    class="input-field"
                                                    appearance="outline">
                                                    <input matInput
                                                        placeholder="Result"
                                                        formControlName="result">
                                                </mat-form-field>
                                            </div>
                                            <button type="button" mat-button
                                                class="center"
                                                (click)="addExperimentActivity(i)">
                                                <mat-icon class="add-new"
                                                    matTooltip="New Activity">add_circle_outline</mat-icon>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <span mat-caption
                                        class="input-label header3 mt-16 vertical-center">
                                        Upload an Excel or CSV File for
                                        Experiment
                                        {{i+1}} (Optional)
                                    </span>
                                    <mat-form-field appearance="outline"
                                        style="width:25%">
                                        <ngx-mat-file-input
                                            formControlName="dataFile"
                                            (change)="onUploadFile($event, i,0, 'file')">
                                            <mat-icon ngxMatFileInputIcon
                                                class="accent bigger-icon">upload</mat-icon>
                                        </ngx-mat-file-input>

                                    </mat-form-field>

                                </div>
                                <mat-divider></mat-divider>
                            </div>

                            <div class="center">
                                <span mat-caption
                                    class="header3">
                                    Add new
                                    Experiment </span>
                                <br>
                                <button type="button" mat-button
                                    (click)="addExperiment()">
                                    <mat-icon class="add-new"
                                        matTooltip="New Parameter">add_circle_outline</mat-icon>
                                </button>
                            </div>
                            <mat-card-actions>
                                <button type="button" mat-raised-button
                                    matStepperPrevious
                                    class="secondary-button header2">Back</button>
                                <button type="button" class="header2"
                                    mat-raised-button
                                    matStepperNext>Next</button>
                            </mat-card-actions>
                        </mat-step>
                    </div>
                    <div formGroupName="activities">
                        <mat-step label="Activities"
                            [stepControl]="activities">
                            <div
                                *ngFor="let activity of activities.controls; index as i"
                                [formGroupName]="i">
                                <div style="display: flex">
                                    <span mat-caption
                                        class="accent input-label header3">
                                        Activity
                                        {{i+1}}
                                    </span>
                                    <button type="button" mat-button
                                        (click)="deleteActivity(i)">
                                        <mat-icon
                                            class="bigger-icon accent"
                                            matTooltip="Delete Activity">delete</mat-icon>
                                    </button>
                                </div>
                                <span mat-caption class="input-label header3">
                                    Exercise Statement </span>
                                <mat-form-field class="input-field"
                                    appearance="outline">
                                    <input matInput placeholder="Question 1"
                                        formControlName="statement" required>
                                </mat-form-field>
                                <span mat-caption class="input-label header3">
                                    Expected Result (Optional) </span>
                                <mat-form-field class="input-field"
                                    appearance="outline">
                                    <input matInput placeholder="Result"
                                        formControlName="result">
                                </mat-form-field>
                            </div>
                            <div class="center">
                                <span mat-caption
                                    class="header3">
                                    Add new
                                    Activity </span>
                                <br>
                                <button type="button" mat-button
                                    (click)="addActivity()">
                                    <mat-icon class="add-new"
                                        matTooltip="New Experiment">add_circle_outline</mat-icon>
                                </button>
                            </div>

                            <mat-card-actions>
                                <button type="button" mat-raised-button
                                    matStepperPrevious
                                    class="secondary-button header2">Back</button>
                                <button type="submit" mat-raised-button
                                    class="header2">Create Laboratory</button>
                            </mat-card-actions>

                        </mat-step>
                    </div>
                </mat-stepper>
            </form>
        </mat-card-content>
    </mat-card>
</div>
